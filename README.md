# IPv6 Socket Programming

π[ wiki](https://github.com/gywn-dev/socketIPv6/wiki)
<br/><br/>

### β™οΈ **2021λ…„ 2ν•™κΈ° μµν•κΈ° κµμλ‹ μ»΄ν“¨ν„°λ„¤νΈμ›κ°λ΅  ν”„λ΅μ νΈ**

- Socket programmingμ„ ν†µν•΄ IPv4 λ° IPv6 ν†µμ‹  κµ¬ν„

	- [1. `IPv4 ν΄λΌμ΄μ–ΈνΈ`λ΅ IPv4 μ„λ²„μ— μ ‘μ†ν•μ—¬ μμ‹ μ IPv6 μ„λ²„ IP λ° ν¬νΈλ²νΈ μ „λ‹¬](#1-ipv4-clientκ°€-ipv4-μ„λ²„μ—-μ ‘μ†)

	- [2. `IPv6 μ„λ²„`λ” concurrentν•κ² κµ¬ν„λμ–΄ IPv6 ν΄λΌμ΄μ–ΈνΈ(μ΄ 5κ°, multi clients)κ°€ μ „λ‹¬ν•λ” 20λ°”μ΄νΈμ§λ¦¬ λ‚μ 5κ°λ¥Ό μμ‹  ν›„, μ΄λ¥Ό `IPv4 ν΄λΌμ΄μ–ΈνΈ`μ— μ „λ‹¬](#2-ipv6-μ„λ²„κ°€-multi-clientsλ΅λ¶€ν„°-5κ°μ-ν† ν°μ„-μμ‹ -ν›„-μ „λ‹¬)

	- [3. `IPv4 ν΄λΌμ΄μ–ΈνΈ`λ” μ „λ‹¬λ°›μ€ ν† ν° 5κ°λ¥Ό IPv4 μ„λ²„μ— μ „μ†΅](#3-ipv4-ν΄λΌμ΄μ–ΈνΈκ°€-μ „λ‹¬λ°›μ€-ν† ν°-5κ°λ¥Ό-ipv4-μ„λ²„μ—-μ „μ†΅)

- multi clientsμ— λ€μ‘ν•λ” concurrent μ„λ²„ κµ¬ν„ ν•„μ”

- IPv6 μ„λ²„λ¥Ό μ„ν• tunneling ν•„μ”
<br/>

## 1. Protocol and Program details
<img width="85%" src="https://user-images.githubusercontent.com/94846990/144199378-92fcc5a1-3638-4cf2-9fd8-86fe0d000d02.png">
<br/>

## 2. Used Environment
- Host OS: macOS Monterey 12.0.1
- Guest OS: Ubuntu 20.0 on VMware Fusion
- Language: C
- IDE: VScode on Ubuntu (20.04)
<br/>

## 3. Programming
### 1\) IPv4 clientκ°€ IPv4 μ„λ²„μ— μ ‘μ†
- **IPv6 μ„λ²„ IP λ° ν¬νΈλ²νΈ μ „λ‹¬**
	- μμ‹λ΅ μ£Όμ–΄μ§„ example.pcap νμΌμ„ ν™•μΈν•΄λ³΄λ©΄, λ¨Όμ € ν„°λ―Έλ„ μƒμ μƒ‰μ„ μ§€μ •ν•λ” ν¨ν‚·μ΄ ν• λ² μμ‹ λ λ‹¤μ λ©”μ„Έμ§€κ°€ μ „μ†΅λ¨. λ”°λΌμ„ ν¨ν‚·μ„ λ‘ λ² μ—°μ†μΌλ΅ μ½μ–΄μ™€μ•Ό ν•  κ²ƒ
	- μ£Όμ–΄μ§„ λ¬Έν•­μ— λ‹µλ³€ν•λ” ν¨ν‚·μ„ λ³΄λ‚Ό λ•, `scanf()`λ¥Ό μ‚¬μ©ν•λ©΄ κ°ν–‰λ¬ΈμκΉμ§€ λ²„νΌμ— μ €μ¥λκ³ , μ΄ ν•¨μλ” κ°ν–‰λ¬Έμ μ§μ „κΉμ§€λ§ λ²„νΌμ—μ„ μ½μ–΄λ“¤μ—¬ λ³€μμ— μ €μ¥ν•λ―€λ΅ λ‹¤μλ² λ¬Έν•­μ— λ‹µλ³€ν•λ ¤ ν•  λ• λ²„νΌμ— λ‚¨μ•„μλ κ°ν–‰λ¬Έμλ΅ μΈν•΄ μ‚¬μ©μμ μ…λ ¥μ„ λ°›μ§€ μ•κ³  λ„μ–΄κ°€λ” λ¬Έμ κ°€ λ°μƒν•  κ²ƒ
		- `read()`ν•¨μλ¥Ό μ‚¬μ©ν•μ—¬ νμΌ λ””μ¤ν¬λ¦½ν„° μΈμλ΅ `0`μ„ μ£Όλ©΄ ν‘μ¤€ μ…λ ¥μΌλ΅λ¶€ν„° μ½μ–΄λ“¤μ΄λ―€λ΅ ν•΄κ²° κ°€λ¥
	- `read()` ν•¨μλ¥Ό ν†µν•΄ νμΌμ len λ°”μ΄νΈ λ§νΌ μ½μΌλΌκ³  μ”μ²­ν•μ€μ§€λ§ μ½μ€ λ°μ΄ν„°κ°€ μ—†λ‹¤λ©΄, `read()`λ” μ½μ€ λ°”μ΄νΈκ°€ μƒκΈΈ λ• κΉμ§€ `block`λλ‹¤. μ΄ μ‹μ¤ν… μ½λ΅ μΈν• λΈ”λ΅μ€ κ³§ ν”„λ΅μ„Έμ¤κ°€ λΈ”λ΅λ¨μ„ μλ―Έν•λ―€λ΅, IPv4 ν΄λΌμ΄μ–ΈνΈλ” `fork()` λ“±μ λ°©λ²•μ„ μ‚¬μ©ν•μ§€ μ•κ³  λ‹¨μΌ ν”„λ΅μ„Έμ¤λ΅ μ‘λ™λκ³  μμμ„ κ³ λ ¤ν–μ„ λ• `read()` μ•„λ«λ¶€λ¶„μ μ½”λ“λ” μ‘λ™ν•μ§€ μ•κ³  κ°™μ΄ λΈ”λ΅λλ‹¤. μ¦‰ `read()` ν•¨μλ¥Ό λ¬΄λ¶„λ³„ν•κ² μ“°λ©΄ ν”„λ΅κ·Έλ¨μ΄ μ¤‘κ°„μ— λ©μ¶ κ²ƒ μ²λΌ λ³΄μΌ κ²ƒ.
<br/><br/>

### 2\) IPv6 μ„λ²„κ°€ multi clientsλ΅λ¶€ν„° 5κ°μ ν† ν°μ„ μμ‹  ν›„ μ „λ‹¬
**(1) Concurrent IPv6 μ„λ²„ κµ¬ν„**
- concurrentν•κ² κµ¬ν„ν•μ§€ μ•μΌλ©΄ `accept()` μ”μ²­ μμ²΄κ°€ μμ‹ λμ§€ μ•μ
- μμ‹ ν”„λ΅μ„Έμ¤κ°€ μ½μ–΄λ“¤μΈ ν† ν° κ°’μ„ λ¶€λ¨ ν”„λ΅μ„Έμ¤μ—κ² μ „λ‹¬ν•λ” IPC ν†µμ‹  ν•„μ”
	- μμ‹ ν”„λ΅μ„Έμ¤κ°€ λ°μ΄ν„°λ¥Ό μ „λ‹¬ν•λ©΄ λ¶€λ¨ ν”„λ΅μ„Έμ¤κ°€ μ½μ–΄λ“¤μ΄λ” λ‹¨λ°©ν–¥ ν†µμ‹ μ΄λ―€λ΅ κ°„λ‹¨ν•κ² `PIPE` λ°©μ‹ μ‚¬μ©
<br/><br/>

**(2) IPv6 μ„λ²„μ™€ IPv4 ν΄λΌμ΄μ–ΈνΈ κ°„ ν†µμ‹ **
- μ•μ„ IPv6 μ„λ²„ λ‚΄μ—μ„μ IPCμ™€ λ‹¤λ¥΄κ² IPv6 μ„λ²„μ™€ IPv4 ν΄λΌμ΄μ–ΈνΈ κ°„ IPCμ κ²½μ° λ‘ ν”„λ΅μ„Έμ¤μ PPIDκ°€ λ‹¤λ¥΄λ―€λ΅ λ‹¤λ¥Έ λ°©μ‹μ IPC ν•„μ”
- `fopen()` λ“±μ λ°©μ‹μΌλ΅ νμΌμ„ μƒμ„±ν•΄μ„ μ“°κ³  μ½λ” λ°©μ‹μ ν†µμ‹ μ€ κΈμ§€λ¨
	- μ•μ„  `PIPE` λ°©μ‹μ κ²½μ° μ΄λ¦„μ„ λ¶™μ΄λ©΄ (`named PIPE`) PPIDλ¥Ό κ³µμ ν•μ§€ μ•λ” ν”„λ΅μ„Έμ¤ κ°„ ν†µμ‹ λ„ κ°€λ¥ν•μ§€λ§, `PIPE` λ°©μ‹ μμ²΄κ°€ `temporal FIFO νμΌ`μ„ λ§λ“¤μ–΄ νμΌ λ””μ¤ν¬λ¦½ν„°λ¥Ό ν†µν•΄ μ ‘κ·Ό λ° μ½κ³  μ“°λ” λ°©μ‹μ΄λ―€λ΅ `PIPE` λ€μ‹  `Message Queue` λ°©μ‹μ„ μ‚¬μ©ν•¨
<br/><br/>

### 3\) IPv4 ν΄λΌμ΄μ–ΈνΈκ°€ μ „λ‹¬λ°›μ€ ν† ν° 5κ°λ¥Ό IPv4 μ„λ²„μ— μ „μ†΅
- μ „μ†΅ μ‹ λ°μ΄ν„°μ λ§μ§€λ§‰μ„μ„ μ•λ¦¬λ” λ¬Έμ(νΉμ€ μ«μ) μ¶”κ°€ ν•„μ”
<br/><br/>

## 4. Result
<img src="https://user-images.githubusercontent.com/94846990/146135823-73d8871f-9dd0-4dcc-ac7c-19ffd081af34.png">
<br/>

## 5. Further Discussion
- IPv6 μ„λ²„μ λ¶€λ¨ ν”„λ΅μ„Έμ¤κ°€ λ¨λ“  ν† ν° μμ‹ μ΄ λλ‚ ν›„ `listen()`μ— μ‚¬μ©λμ—λ μ†μΌ“μ„ λ‹«μ•„μ£Όμ§€ λ»ν–λ‹¤(`close(listen_sock_fd)` ν•„μ”). μ μ¶μ΄ λλ‚κ³  μ•μ•„μ°¨λ ¤μ„ λ„λ¬΄ μ•„μ‰½λ‹¤π­
- trialsμ IPv6μ„λ²„ μ½”λ“μ™€ μµμΆ… μ μ¶ν• IPv6 μ„λ²„ μ½”λ“μ™€μ μ°¨μ΄μ μ€ <u>(1) μμ‹ ν΄λΌμ΄μ–ΈνΈκ°€ `if (pid==0)` λ¬Έ μ•μ—μ„ `listen`μ— μ‚¬μ©λ μ†μΌ“μ„ λ‹«λλƒ λ‹«μ§€ μ•λλƒ</u> ν•λ” λ¶€λ¶„κ³Ό <u>(2) μμ‹ ν΄λΌμ΄μ–ΈνΈκ°€ `accept`λ μ†μΌ“μΌλ΅λ¶€ν„° ν† ν°μ„ μ½μ–΄μ¬ λ• `read()` ν•¨μλ΅ κ·Έλƒ¥ ν• λ² μ½μ–΄μ¤λλƒ λλ” μ½μ„ λ°”μ΄νΈκ°€ μ—†μ„ λ•κΉμ§€ `while`λ¬ΈμΌλ΅ μ½μ–΄μ¤λλƒ</u> ν•λ” λ¶€λ¶„μ λ‘ κ°€μ§€ λΏμΈλ°, trialsμ μ½”λ“λ” μ‘λ™ν•μ§€ μ•μ•μ–΄μ„ μ •ν™•ν μ–΄λ λ¶€λ¶„μ΄ λ¬Έμ λ¥Ό λ°μƒμ‹μΌ°λ”μ§€ μ λ€λ΅ νμ•…ν•κ³  μ‹¶λ‹¤.
- μ†μΌ“ ν”„λ΅κ·Έλλ°μΈ λ§νΌ IPv6 μ„λ²„μ™€ IPv4 ν΄λΌμ΄μ–ΈνΈ κ°„μ ν†µμ‹ λ„ μ†μΌ“μΌλ΅ ν•΄λ³΄κ³  μ‹¶μ—λ”λ° λ¨Έλ¦¬κ°€ λ³µμ΅ν•΄μ Έμ„ κ·Έλ¬μ§€ λ»ν–λ‹¤. μ΄λ―Έ ν•λ‚μ μ†μΌ“μ΄ μ—΄λ ¤μ„ λ‹¤λ¥Έ ν”„λ΅κ·Έλ¨κ³Ό ν†µμ‹ ν•κ³  μμ„ λ• λλ‹¤λ¥Έ μ†μΌ“μ„ μ—΄μ–΄ ν•λ‚μ ν†µμ‹ μ„ λ” ν•λ” λ°©λ²•μ„ κ³µλ¶€ν•΄λ΄μ•Ό ν•  λ“― μ‹¶λ‹¤.
